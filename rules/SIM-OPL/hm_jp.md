[日本語](./hm_ja.md) | [English](./hm_en.md)

# Handyman（HM）

参考動画：[Handyman_jp_2023](https://www.youtube.com/watch?v=Z0xf8hgyVzg)

> **Note**
> 参考動画は完璧ではない．開催年度のルールによってタスク内容が異なる可能性があるので，あくまで参考程度にしてください．
> 気になる点や議論したい点などがありましたら，GitHubの[Issues](https://github.com/RoboCupAtHomeJP/Rule2023/issues)にてご記入ください．


## メインゴール（Main Goal）

このタスクでは，人間の日常生活をサポートするロボットの基本的な能力を評価する．
タスクの内容は，与えられた指示に従って物体を探索，把持，運搬するものである．


## フォーカス（Focus）

このタスクは，命令文の内容理解，障害物を考慮した自律移動，物体認識，物体操作，人物検出，タスクプランニングなどに焦点を当てている．
加えて，存在しない物体を探す指示のように命令文が誤っている場合には，その誤りを検知し指摘することが求められる．

## セットアップ（Settings）
- **システム構成**：本競技ではシミュレーション環境を実行するWindows PCと，各チームが開発するロボットコントローラを実行するUbuntu PCでrosbridge serverを介した通信を行う．これにより，ロボットのセンサデータの取得や，アバターとロボットのインタラクションを行う．
- **Handyman-ソフトウェア**：シミュレーション環境を実行するWindows PCでは，UnityとSIGVerseをベースにHandymanソフトウェアを実行する．このソフトウェアは，JointState，TF，センサー情報，その他のROSメッセージを一定間隔でロボットコントローラに送信する．セットアップ手順はこちら（なんかのリンク）
- **ロボットコントローラ**：各チームはUbuntu環境において，Handymanタスクを行うためのロボット制御プログラムの開発を行う．TwistやJointTrajectory，その他のROSメッセージを送信することでロボットを制御する．Ubuntu環境のセットアップ手順はこちら（なんかのリンク）
- **ロケーション**：家庭環境を模したSIGVerse上のシミュレーション環境が用いられる．本競技に用いられる環境は複数あり，

- **あ**： アバターーの近く（2\[m\]以内の距離でロボットから見える位置）に，2つの紙バッグを設置する．
  <!-- - [荷物(バッグ)](https://www.amazon.co.jp/gp/product/B07T52SRRN/ref=ppx_yo_dt_b_asin_title_o00_s00?ie=UTF8&psc=1)には，200×240×90[mm]のものを使用する．-->
  - **サイズ**：260×10×310\[mm\] [Amazonリンク](https://www.amazon.co.jp/dp/B0173OZPSW/?th=1)．
  - **配置場所**：自チームで行う．この際，荷物（紙バッグ）は椅子の上に設置していく（椅子はフォロミーの経路上に被らないように[Tidy Up for OPL](./tu_ja.md#物体カテゴリーごと配置場所object-category-and-placement-goal)タスクと同じ配置となる）．
- **アバターー**： アバターーは，ロボットの前に立って競技で使用する紙バッグを指さす．アバターーは自チームから選出してください．

> **Warning**
> Educationリーグのルールに合わていく方針のため、ルールが変わる可能性がある．その際，全体で共有する．

## シナリオ（Scenario）

### スタートフェーズ（Starting Phase）

1. **競技時間**：競技時間は**7分間**となる．
1. **配置**：レフェリーは，チームにロボットをスタート位置へ移動させるよう指示する．
1. **スタート**：レフェリーはスタートの合図を出し，タイマーをスタートさせる．同時にチームは最後の簡単なセットアップ（スタートボタンを押す等）を完了し，エリアを離れる．このとき，ボタンを2つ以上押すなど複雑なセットアップ手順の実施は認められない．
1. **指差し**：アバターはスタートの合図と同時に，2つの紙バッグの内，事前に指定されたバッグの方を指さす．
1. **把持**：ロボットは，アバターが指さしたバッグを認識し，それを把持する．

### フォロミーフェーズ（Follow-Me Phase）

1. **運搬開始**：ロボットが紙バッグを把持し追従可能な状態になったら，ロボットはアバターーにその主旨を伝える．
1. **歩行**：その後，アバターは既知環境から未知環境に向かって歩き始める．このとき，アリーナの外にあるゴール地点は固定の場所とする．
1. **フォロミー**：ロボットは歩き始めたアバターを追従し，走行する．アバターがゴールにたどり着いた場合，アバターからその主旨を伝えてもらう．

> **Warning**
> アバターーが歩行し始めたら、ロボットの方に向いたり，歩行を止まったりすることは禁止とする．

### ナビゲーションフェーズ（Navigation Phase）

1. **受け渡し**：アバターとロボットがゴールに着いた後，アバターーはロボットからバッグを受け取り，ロボットにお礼をする．
1. **ナビゲーション**：ロボットは未知環境から既知環境にある`スタート地点`まで自律的に移動する．このとき，ロボットは様々な障害物を回避しながら自律走行を行う．ただし，この障害物に挑戦するかどうかは各チームで決めることができる（障害物を回避するごとに加点される）．
この障害物の種類には下記の4つのモノがある．
   - 人混み（3～4人）が静的な状態で邪魔をする
   - 地面にある小さな物体（積み木など）
   - 見づらい3Dオブジェクト（椅子やグラスなど）
   - 開閉式バリア（ガイドポールなど）
1. **ゴール**：ロボットが`スタート地点`へ戻ったら，タスク終了になる．


## デウス・エクス・マキナ（Deus ex Machina）

本タスクでは，次のデウス・エクス・マキナが採用される．デウス・エクス・マキナでは該当アクションの点数は入らないが，より簡単な手法で部分的なタスクをスキップし，全体的なタスクを継続することができる．

<table>
  <tr>
    <th> <b>Action<b> </th>
    <th> <b>Bypassing<b> </th>
  </tr>
  <tr>
    <td> 紙バッグの選択 </td>
    <td>
      <ul>
        <li> 設置されている2つの紙バッグの中で1つに限定する </li>
        <li> 1つの紙バッグのみが設置される </li>
      </ul> 
    </td>
  </tr>
   <tr>
    <td> 紙バッグの把持 </td>
    <td>
      <ul>
        <li> ロボットが選択したバッグを，アバターがロボットに持たせる </li>
        <li> その際，ロボットがアバターーに紙バッグの位置を伝える </li>
      </ul> 
    </td>
  </tr>
  <tr>
    <td> マーカを用いた人追従走行 </td>
    <td>
      <ul>
        <li> マーカをアバターに持たせた状態または取り付けた状態で人追従走行を行う </li>
      </ul> 
    </td>
  </tr>
  <!--
   <tr>
    <td> 未知環境のマッピング </td>
    <td>
      <ul>
        <li> 事前にマッピングしてはいけない屋外の範囲にマッピングを行う
 </li>
        <li> この場合，マッピングが影響する自律移動の得点は半分とする（スコアシート中の「☆」の箇所）
 </li>
      </ul> 
    </td>
  </tr>
  -->
</table>


## スコアシート（Score Sheet）

<table>
  <tr>
    <th> <b>Action</b> </th>
    <th> <b>Score</b> </th>
  </tr>
  <tr>
    <td colspan="2" align="center"> <b>メインタスク</b> </td>
  </tr>
  <tr>
    <td> 紙バッグをアリーナの外にあるゴールまで持ち運ぶ <br> 
      <ul>
        <li> アバターが選択した紙バッグの検出 </li>
        <li> 選択されたバッグの把持 </li>
        <li> アバターーを追従してアリーナの外に出る </li>
        <li> アバターーを追従してアリーナの外にあるゴールへ着く </li>
      </ul> 
    </td>
<!--     <td> 250 <br> 
      <ul  style="list-style: none;">
        <li> 50 </li>
        <li> 100 </li>
        <li> 50 </li>
        <li> 50 </li>
      </ul> 
    </td> -->
    <td align="center"> <!-- 250 <br> --> 50 <br> 100 <br> 50 <br> 50 </td>
  </tr>
  <tr>
    <td colspan="2" align="center"> <b> ボーナスタスク </b> </td>
  </tr>
  <tr>
    <td> アリーナへの再入場
      <ul>
        <li> 自律的にアリーナ内に入る </li>
        <li> 自律的に`スタート地点`へ戻る </li>
    </td>
    <td align="center"> <!-- 50 <br> --> 25 <br> 25 </td>
  </tr>
  <tr>
    <td> 静的な人混み（3～4人）を回避する <br> </td>
    <td align="center"> 50 </td>
  </tr>
  <tr>
    <td> 地面にある小さな物体（積み木など）を回避する <br> </td>
    <td align="center"> 50 </td>
  </tr>
  <tr>
    <td> 見づらい3Dオブジェクト（椅子やグラスなど）を回避する <br> </td>
    <td align="center"> 50 </td>
  </tr>
  <tr>
    <td> 開閉式バリア（ガイドポールなど）を回避する <br> </td>
    <td align="center"> 50 </td>
  </tr>
  <tr>
    <td colspan="2" align="center"> <b>ペナルティ</b> </td>
  </tr>
  <tr>
    <td> 不参加（無断） </td>
    <td align="center"> -500 </td>
  </tr>
  <tr>
    <td> <b>合計（ボーナスタスクを含む）</b> </td>
    <td align="center"> <b>500</b> </td>
  </tr>
</table>


> **Note**
> Educationリーグと同じ競技を採用し，ルール内容も同じなのですが，差別化のため異なる採点方式を用いている．

> **Note**
> 開閉式バリア（ガイドポールなど）は，三角形のものを3本ほど用いる．`Setup Day`から使用可能（予定）．


## 運営(EC)による指示（Instructions from the Executive Committee(EC)）

- 準備
  - Ubuntu PCでロボットコントローラやSIGVerse rosbridgeなどを起動する．
  - Windows PCでHnadyman-ソフトウェアを起動する．
  - 


## レフェリー(OC)の動き（Role of the Referee(TC)）

- 競技開始30分前に集まり，競技者とともに接続確認を行う．
- スコアシートに基づき，競技を採点する．
- 他のTCと採点内容を確認し合う．
- スコアシートを提出する．

> **Note**
> TCは各チームから数名選出され，他チームの競技において以下を行ってもらう．詳細については，一般規定の[採点方法](./gr_ja.md#採点方法scoring-system)をご確認ください．
